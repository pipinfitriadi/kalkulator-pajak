<!-- Copyright (C) Pipin Fitriadi <pipinfitriadi@gmail.com>. All rights reserved.
Licensed under the Microsoft Reference Source License. See LICENSE in the
project root for license information. -->

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Pajak</title>
    <link rel="icon" type="image/x-icon" href="/kalkulator-pajak/favicon.ico"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
</head>
<body class="p-2">
    <h1 class="text-center">Kalkulator Pajak</h1>
    <form class="mb-2">
        <div class="input-group mb-2">
            <span class="input-group-text">Rp</span>
            <div class="form-floating">
                <input type="number" min="0" step="1" class="form-control" name="penghasilan" id="penghasilan" value="0"/>
                <label for="penghasilan">Penghasilan per bulan (<i>bruto</i>)</label>
            </div>
        </div>
        <div class="btn-group d-flex mb-2" role="group">
            <input type="checkbox" class="btn-check" name="biayaJabatan" id="biayaJabatan" checked/>
            <label class="btn btn-outline-primary" for="biayaJabatan">Biaya Jabatan</label>
            <input type="checkbox" class="btn-check" name="biayaPensiun" id="biayaPensiun"/>
            <label class="btn btn-outline-primary" for="biayaPensiun">Biaya Pensiun</label>
        </div>
        <div class="form-floating mb-2">
            <select class="form-select text-truncate" name="statusKawinTanggungan" id="statusKawinTanggungan">
                <optgroup label="Tidak Kawin">
                    <option value="TK-0">Tidak Kawin Tanpa Tanggungan</option>
                    <option value="TK-1">Tidak Kawin Tanggungan 1 orang</option>
                    <option value="TK-2">Tidak Kawin Tanggungan 2 orang</option>
                    <option value="TK-3">Tidak Kawin Tanggungan 3 orang</option>
                </optgroup>
                <optgroup label="Kawin">
                    <option value="K-0">Kawin Tanpa Tanggungan</option>
                    <option value="K-1">Kawin Tanggungan 1 orang</option>
                    <option value="K-2">Kawin Tanggungan 2 orang</option>
                    <option value="K-3">Kawin Tanggungan 3 orang</option>
                </optgroup>
                <optgroup label="Kawin dengan Penggabungan Penghasilan Istri">
                    <option value="KI-0">Kawin dengan Penggabungan Penghasilan Istri dan Tanpa Tanggungan</option>
                    <option value="KI-1">Kawin dengan Penggabungan Penghasilan Istri dan Tanggungan 1 orang</option>
                    <option value="KI-2">Kawin dengan Penggabungan Penghasilan Istri dan Tanggungan 2 orang</option>
                    <option value="KI-3">Kawin dengan Penggabungan Penghasilan Istri dan Tanggungan 3 orang</option>
                </optgroup>
            </select>
            <label for="statusKawinTanggungan">Status Perkawinan dan Jumlah Tanggungan</label>
        </div>
        <div class="btn-group d-flex" role="group">
            <input class="btn btn-outline-secondary" type="reset" value="Reset"/>
            <button class="btn btn-outline-success" type="submit">
                <i class="bi bi-calculator"></i>
                Hitung
            </button>
        </div>
    </form>
    <table class="table table-sm table-hover table-striped visually-hidden">
        <thead>
            <tr>
                <th scope="col" class="text-center">Bulan</th>
                <th scope="col" class="text-center">Pajak</th>
                <th scope="col" class="text-center">Penghasilan (<i>netto</i>)</th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
            <tr>
                <td>Januari</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Februari</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Maret</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>April</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Mei</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Juni</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Juli</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Agustus</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>September</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Oktober</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr>
                <td>Nopember</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
            <tr class="table-warning">
                <td>Desember</td>
                <td class="text-end"></td>
                <td class="text-end"></td>
            </tr>
        </tbody>
        <tfoot class="table-success table-group-divider">
            <tr>
                <th>Total Setahun</th>
                <th class="text-end"></th>
                <th class="text-end"></th>
            </tr>
        </tfoot>
    </table>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script>
        function pajakPenghasilanPasal21(penghasilanKenaPajak) {
            let hasil = 0;

            for (let i = 0; i < pajakPenghasilanPasal17Ayat1.length; i++) {
                const elem = pajakPenghasilanPasal17Ayat1[i];

                hasil += elem.tarifPajak * (
                    penghasilanKenaPajak <= elem.penghasilanBrutoBulanan ?
                    penghasilanKenaPajak : elem.penghasilanBrutoBulanan
                );
                penghasilanKenaPajak -= elem.penghasilanBrutoBulanan;

                if (penghasilanKenaPajak <= 0) {
                    break;
                }
            }

            return hasil;
        }

        class TarifPajak {
            constructor(penghasilanBrutoBulanan, tarifPajak) {
                this.penghasilanBrutoBulanan = penghasilanBrutoBulanan;
                this.tarifPajak = tarifPajak;
            }
        }
          
        const
            LOCALE_STRING = 'id-ID',
            form = document.querySelector('form'),
            table = document.querySelector('table'),
            pajakPenghasilanPasal17Ayat1 = [
                new TarifPajak(60000000, 5/100),
                new TarifPajak(250000000, 15/100),
                new TarifPajak(500000000, 25/100),
                new TarifPajak(5000000000, 30/100),
                new TarifPajak(5000000000.01, 30/100)
            ],
            kategoriA = [
                new TarifPajak(5400000, 0/100),
                new TarifPajak(5650000, 0.25/100),
                new TarifPajak(5950000, 0.5/100),
                new TarifPajak(6300000, 0.75/100),
                new TarifPajak(6750000, 1/100),
                new TarifPajak(7500000, 1.25/100),
                new TarifPajak(8550000, 1.5/100),
                new TarifPajak(9650000, 1.75/100),
                new TarifPajak(10050000, 2/100),
                new TarifPajak(10350000, 2.25/100),
                new TarifPajak(10700000, 2.5/100),
                new TarifPajak(11050000, 3/100),
                new TarifPajak(11600000, 3.5/100),
                new TarifPajak(12500000, 4/100),
                new TarifPajak(13750000, 5/100),
                new TarifPajak(15100000, 6/100),
                new TarifPajak(16950000, 7/100),
                new TarifPajak(19750000, 8/100),
                new TarifPajak(24150000, 9/100),
                new TarifPajak(26450000, 10/100),
                new TarifPajak(28000000, 11/100),
                new TarifPajak(30050000, 12/100),
                new TarifPajak(32400000, 13/100),
                new TarifPajak(35400000, 14/100),
                new TarifPajak(39100000, 15/100),
                new TarifPajak(43850000, 16/100),
                new TarifPajak(47800000, 17/100),
                new TarifPajak(51400000, 18/100),
                new TarifPajak(56300000, 19/100),
                new TarifPajak(62200000, 20/100),
                new TarifPajak(68600000, 21/100),
                new TarifPajak(77500000, 22/100),
                new TarifPajak(89000000, 23/100),
                new TarifPajak(103000000, 24/100),
                new TarifPajak(125000000, 25/100),
                new TarifPajak(157000000, 26/100),
                new TarifPajak(206000000, 27/100),
                new TarifPajak(337000000, 28/100),
                new TarifPajak(454000000, 29/100),
                new TarifPajak(550000000, 30/100),
                new TarifPajak(695000000, 31/100),
                new TarifPajak(910000000, 32/100),
                new TarifPajak(1400000000, 33/100),
                new TarifPajak(1400000000.01, 34/100),
            ],
            kategoriB = [
                new TarifPajak(6200000, 0/100),
                new TarifPajak(6500000, 0.25/100),
                new TarifPajak(6850000, 0.5/100),
                new TarifPajak(7300000, 0.75/100),
                new TarifPajak(9200000, 1/100),
                new TarifPajak(10750000, 1.5/100),
                new TarifPajak(11250000, 2/100),
                new TarifPajak(11600000, 2.5/100),
                new TarifPajak(12600000, 3/100),
                new TarifPajak(13600000, 4/100),
                new TarifPajak(14950000, 5/100),
                new TarifPajak(16400000, 6/100),
                new TarifPajak(18450000, 7/100),
                new TarifPajak(21850000, 8/100),
                new TarifPajak(26000000, 9/100),
                new TarifPajak(27700000, 10/100),
                new TarifPajak(29350000, 11/100),
                new TarifPajak(31450000, 12/100),
                new TarifPajak(33950000, 13/100),
                new TarifPajak(37100000, 14/100),
                new TarifPajak(41100000, 15/100),
                new TarifPajak(45800000, 16/100),
                new TarifPajak(49500000, 17/100),
                new TarifPajak(53800000, 18/100),
                new TarifPajak(58500000, 19/100),
                new TarifPajak(64000000, 20/100),
                new TarifPajak(71000000, 21/100),
                new TarifPajak(80000000, 22/100),
                new TarifPajak(93000000, 23/100),
                new TarifPajak(109000000, 24/100),
                new TarifPajak(129000000, 25/100),
                new TarifPajak(163000000, 26/100),
                new TarifPajak(211000000, 27/100),
                new TarifPajak(374000000, 28/100),
                new TarifPajak(459000000, 29/100),
                new TarifPajak(555000000, 30/100),
                new TarifPajak(704000000, 31/100),
                new TarifPajak(957000000, 32/100),
                new TarifPajak(1405000000, 33/100),
                new TarifPajak(1405000000.01, 34/100),
            ],
            kategoriC = [
                new TarifPajak(6600000, 0/100),
                new TarifPajak(6950000, 0.25/100),
                new TarifPajak(7350000, 0.5/100),
                new TarifPajak(7800000, 0.75/100),
                new TarifPajak(8850000, 1/100),
                new TarifPajak(9800000, 1.25/100),
                new TarifPajak(10950000, 1.5/100),
                new TarifPajak(11200000, 1.75/100),
                new TarifPajak(12050000, 2/100),
                new TarifPajak(12950000, 3/100),
                new TarifPajak(14150000, 4/100),
                new TarifPajak(15550000, 5/100),
                new TarifPajak(17050000, 6/100),
                new TarifPajak(19500000, 7/100),
                new TarifPajak(22700000, 8/100),
                new TarifPajak(26600000, 9/100),
                new TarifPajak(28100000, 10/100),
                new TarifPajak(30100000, 11/100),
                new TarifPajak(32600000, 12/100),
                new TarifPajak(35400000, 13/100),
                new TarifPajak(38900000, 14/100),
                new TarifPajak(43000000, 15/100),
                new TarifPajak(47400000, 16/100),
                new TarifPajak(51200000, 17/100),
                new TarifPajak(55800000, 18/100),
                new TarifPajak(60400000, 19/100),
                new TarifPajak(66700000, 20/100),
                new TarifPajak(74500000, 21/100),
                new TarifPajak(83200000, 22/100),
                new TarifPajak(95600000, 23/100),
                new TarifPajak(110000000, 24/100),
                new TarifPajak(134000000, 25/100),
                new TarifPajak(169000000, 26/100),
                new TarifPajak(221000000, 27/100),
                new TarifPajak(390000000, 28/100),
                new TarifPajak(463000000, 29/100),
                new TarifPajak(561000000, 30/100),
                new TarifPajak(709000000, 31/100),
                new TarifPajak(965000000, 32/100),
                new TarifPajak(1419000000, 33/100),
                new TarifPajak(1419000000.01, 34/100),
            ],
            kategoriTarifEfektifBulanan = {
                'TK-0': kategoriA,
                'TK-1': kategoriA,
                'K-0': kategoriA,
                'KI-0': kategoriA,
                'TK-2': kategoriB,
                'TK-3': kategoriB,
                'K-1': kategoriB,
                'K-2': kategoriB,
                'K-3': kategoriC,
                'KI-1': kategoriB,
                'KI-2': kategoriB,
                'KI-3': kategoriC
            },
            penghasilanTidakKenaPajak = {
                'TK-0': 54000000,
                'TK-1': 58500000,
                'TK-2': 63000000,
                'TK-3': 67500000,
                'K-0': 58500000,
                'K-1': 63000000,
                'K-2': 67500000,
                'K-3': 72000000,
                'KI-0': 112500000,
                'KI-1': 117000000,
                'KI-2': 121500000,
                'KI-3': 126000000
            },
            pajakCols = document.querySelectorAll('tbody tr:not(:last-child) td:nth-child(2)'),
            pajakDesCol = document.querySelector('tbody tr:last-child td:nth-child(2)'),
            pajakTotalCol = document.querySelector('tfoot th:nth-child(2)'),
            penghasilanNettoCols = document.querySelectorAll('tbody tr:not(:last-child) td:last-child'),
            penghasilanNettoDesCol = document.querySelector('tbody tr:last-child td:last-child'),
            penghasilanTotalCol = document.querySelector('tfoot th:last-child');

        form.onsubmit = function(event) {
            event.preventDefault();

            const penghasilanBruto = parseInt(form.elements.penghasilan.value);

            let foundTarif = kategoriTarifEfektifBulanan[
                form.elements.statusKawinTanggungan.value
            ].find(
                (elem) =>
                    elem.penghasilanBrutoBulanan >= penghasilanBruto
            );
            foundTarif = (
                foundTarif === undefined ?
                kategoriTarifEfektifBulanan[
                    form.elements.statusKawinTanggungan.value
                ].slice(-1)[0] : foundTarif
            );

            const
                pajakJanNov = Math.round(penghasilanBruto * foundTarif.tarifPajak),
                pajakDes = Math.round(
                    pajakPenghasilanPasal21(
                        Math.max(
                            0,
                            penghasilanBruto * 12
                            - Math.min(
                                6000000,
                                form.elements.biayaJabatan.checked ? 
                                penghasilanBruto * 12 * 5/100 : 0
                            )
                            - Math.min(
                                2400000,
                                form.elements.biayaPensiun.checked ? 
                                penghasilanBruto * 12 * 5/100 : 0
                            )
                            - penghasilanTidakKenaPajak[
                                form.elements.statusKawinTanggungan.value
                            ]
                        )
                    )
                    - pajakJanNov * 11
                ),
                penghasilanNettoJanNov = penghasilanBruto - pajakJanNov,
                penghasilanNettoDes = penghasilanBruto - pajakDes;

            pajakCols.forEach(
                (elem) =>
                    elem.textContent = `Rp${pajakJanNov.toLocaleString(LOCALE_STRING)}`
            );
            pajakDesCol.innerHTML = (
                pajakDes >= 0 ?
                `Rp${pajakDes.toLocaleString(LOCALE_STRING)}` :
                `
                <button type="button" class="text-danger btn position-relative">
                    -Rp${Math.abs(pajakDes).toLocaleString(LOCALE_STRING)}
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        Kelebihan Bayar!
                    </span>
                </button>
                `
            );
            pajakTotalCol.textContent = `Rp${(pajakJanNov * 11 + pajakDes).toLocaleString(LOCALE_STRING)}`;

            penghasilanNettoCols.forEach(
                (elem) =>
                    elem.textContent = `Rp${penghasilanNettoJanNov.toLocaleString(LOCALE_STRING)}`
            );
            penghasilanNettoDesCol.textContent = `Rp${penghasilanNettoDes.toLocaleString(LOCALE_STRING)}`;
            penghasilanTotalCol.textContent = `Rp${(penghasilanNettoJanNov * 11 + penghasilanNettoDes).toLocaleString(LOCALE_STRING)}`;

            table.classList.remove('visually-hidden');

            return false;
        }

        form.onreset = function(event) {
            table.classList.add('visually-hidden');

            pajakCols.forEach((elem) => elem.textContent = '');
            pajakDesCol.innerHTML = '';
            pajakTotalCol.textContent = '';

            penghasilanNettoCols.forEach((elem) => elem.textContent = '');
            penghasilanNettoDesCol.textContent = '';
            penghasilanTotalCol.textContent = '';

            return true;
        }
    </script>
</body>
</html>
